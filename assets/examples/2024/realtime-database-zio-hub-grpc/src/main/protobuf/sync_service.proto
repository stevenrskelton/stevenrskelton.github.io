syntax = "proto3";

option java_multiple_files = true;
option java_package = "ca.stevenskelton.examples.realtimeziohubgrpc";
option java_outer_classname = "SyncServiceProto";
option objc_class_prefix = "HLW";

package grpc;

message Data {
  uint32 id = 1;
  string field1 = 2;
}

service SyncService {
  rpc BidirectionalStream (stream SyncRequest) returns (stream SyncResponse) {}
}

message SyncRequest {

  message Subscribe {
    message DataSnapshots {
      uint32 id = 1;
      uint64 last_update = 2;
    }
    repeated DataSnapshots dataSnapshots = 1;
  }

  message Unsubscribe {
    repeated uint32 ids = 1;
  }

  message Update {
    repeated Data data = 1;
  }

  oneof action {
    Subscribe subscribe = 1;
    Unsubscribe unsubscribe = 2;
    Update update = 3;
  }
}

message SyncResponse {
  Data data = 1;
  uint64 last_update = 2;
}